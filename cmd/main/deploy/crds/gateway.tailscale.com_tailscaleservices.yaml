---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  name: tailscaleservices.gateway.tailscale.com
spec:
  group: gateway.tailscale.com
  names:
    categories:
    - tailscale-gateway
    kind: TailscaleServices
    listKind: TailscaleServicesList
    plural: tailscaleservices
    singular: tailscaleservices
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: VIP service name
      jsonPath: .status.vipServiceStatus.serviceName
      name: VIP Service
      type: string
    - description: Total backends
      jsonPath: .status.totalBackends
      name: Backends
      type: integer
    - description: Healthy backends
      jsonPath: .status.healthyBackends
      name: Healthy
      type: integer
    - description: Service DNS name
      jsonPath: .status.vipServiceStatus.dnsName
      name: DNS Name
      type: string
    - description: Load balancing strategy
      jsonPath: .status.loadBalancingStatus.strategy
      name: Strategy
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: TailscaleServices is the Schema for the tailscaleservices API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: TailscaleServicesSpec defines the desired state of TailscaleServices
            properties:
              endpointTemplate:
                description: EndpointTemplate for auto-creating TailscaleEndpoints
                  when none match the selector
                properties:
                  labels:
                    additionalProperties:
                      type: string
                    description: |-
                      Labels to apply to auto-created TailscaleEndpoints
                      These labels should match the selector for this TailscaleServices
                    type: object
                  nameSuffix:
                    description: |-
                      NameSuffix to append to auto-created endpoint names
                      Default: "-endpoints"
                    type: string
                  ports:
                    description: Ports that auto-created endpoints should serve
                    items:
                      description: PortTemplate defines port configuration for auto-created
                        endpoints
                      properties:
                        port:
                          description: Port number
                          format: int32
                          maximum: 65535
                          minimum: 1
                          type: integer
                        protocol:
                          default: TCP
                          description: Protocol (TCP or UDP)
                          enum:
                          - TCP
                          - UDP
                          type: string
                      required:
                      - port
                      type: object
                    type: array
                  proxy:
                    description: Proxy configuration for auto-created endpoints
                    properties:
                      connectionType:
                        default: bidirectional
                        description: 'Connection type: ingress, egress, or bidirectional'
                        enum:
                        - ingress
                        - egress
                        - bidirectional
                        type: string
                      replicas:
                        default: 2
                        description: Number of proxy replicas
                        format: int32
                        minimum: 1
                        type: integer
                    type: object
                  tags:
                    description: Tags for the auto-created tailscale machines
                    items:
                      type: string
                    type: array
                  tailnet:
                    description: Tailnet to connect to
                    type: string
                required:
                - tailnet
                type: object
              loadBalancing:
                description: LoadBalancing configuration for service-level load balancing
                properties:
                  failoverConfig:
                    description: FailoverConfig for failover load balancing
                    properties:
                      failbackDelay:
                        default: 60s
                        description: FailbackDelay is how long to wait before failing
                          back to primary endpoints
                        type: string
                      primaryEndpoints:
                        description: PrimaryEndpoints are the preferred endpoints
                        items:
                          type: string
                        type: array
                      secondaryEndpoints:
                        description: SecondaryEndpoints are used when primary endpoints
                          are unhealthy
                        items:
                          type: string
                        type: array
                    type: object
                  healthCheck:
                    description: HealthCheck configuration for service-level health
                      checking
                    properties:
                      enabled:
                        default: true
                        description: Enabled controls whether service-level health
                          checking is active
                        type: boolean
                      healthyThreshold:
                        default: 2
                        description: HealthyThreshold is the number of consecutive
                          successful checks for healthy status
                        format: int32
                        minimum: 1
                        type: integer
                      interval:
                        default: 30s
                        description: Interval defines how often to perform health
                          checks
                        type: string
                      path:
                        default: /health
                        description: Path is the HTTP path for health checks (HTTP/HTTPS
                          protocols only)
                        type: string
                      timeout:
                        default: 5s
                        description: Timeout defines the timeout for health check
                          requests
                        type: string
                      unhealthyThreshold:
                        default: 3
                        description: UnhealthyThreshold is the number of consecutive
                          failed checks for unhealthy status
                        format: int32
                        minimum: 1
                        type: integer
                    required:
                    - enabled
                    type: object
                  strategy:
                    default: round-robin
                    description: Strategy for load balancing (round-robin, least-connections,
                      weighted)
                    enum:
                    - round-robin
                    - least-connections
                    - weighted
                    - failover
                    type: string
                  weights:
                    additionalProperties:
                      format: int32
                      type: integer
                    description: Weights for weighted load balancing (maps endpoint
                      names to weights)
                    type: object
                type: object
              selector:
                description: Selector for choosing TailscaleEndpoints to include in
                  this service
                properties:
                  matchExpressions:
                    description: matchExpressions is a list of label selector requirements.
                      The requirements are ANDed.
                    items:
                      description: |-
                        A label selector requirement is a selector that contains values, a key, and an operator that
                        relates the key and values.
                      properties:
                        key:
                          description: key is the label key that the selector applies
                            to.
                          type: string
                        operator:
                          description: |-
                            operator represents a key's relationship to a set of values.
                            Valid operators are In, NotIn, Exists and DoesNotExist.
                          type: string
                        values:
                          description: |-
                            values is an array of string values. If the operator is In or NotIn,
                            the values array must be non-empty. If the operator is Exists or DoesNotExist,
                            the values array must be empty. This array is replaced during a strategic
                            merge patch.
                          items:
                            type: string
                          type: array
                          x-kubernetes-list-type: atomic
                      required:
                      - key
                      - operator
                      type: object
                    type: array
                    x-kubernetes-list-type: atomic
                  matchLabels:
                    additionalProperties:
                      type: string
                    description: |-
                      matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                      map is equivalent to an element of matchExpressions, whose key field is "key", the
                      operator is "In", and the values array contains only "value". The requirements are ANDed.
                    type: object
                type: object
                x-kubernetes-map-type: atomic
              serviceDiscovery:
                description: ServiceDiscovery configuration for discovering external
                  services
                properties:
                  discoverVIPServices:
                    default: false
                    description: DiscoverVIPServices indicates whether to discover
                      existing VIP services
                    type: boolean
                  externalServices:
                    description: ExternalServices are external (non-Kubernetes) services
                      to include
                    items:
                      description: ExternalServiceConfig defines configuration for
                        external services
                      properties:
                        address:
                          description: Address of the external service (IP or hostname)
                          type: string
                        name:
                          description: Name of the external service
                          type: string
                        port:
                          description: Port of the external service
                          format: int32
                          maximum: 65535
                          minimum: 1
                          type: integer
                        protocol:
                          default: HTTP
                          description: Protocol of the external service
                          enum:
                          - HTTP
                          - HTTPS
                          - TCP
                          - UDP
                          type: string
                        weight:
                          default: 1
                          description: Weight for load balancing
                          format: int32
                          maximum: 100
                          minimum: 1
                          type: integer
                      required:
                      - address
                      - name
                      - port
                      type: object
                    type: array
                  vipServiceSelector:
                    description: VIPServiceSelector selects existing VIP services
                      to include
                    properties:
                      serviceNames:
                        description: ServiceNames are specific VIP service names to
                          include
                        items:
                          type: string
                        type: array
                      tags:
                        description: Tags to match VIP services
                        items:
                          type: string
                        type: array
                    type: object
                type: object
              vipService:
                description: VIPService configuration for the Tailscale VIP service
                properties:
                  annotations:
                    additionalProperties:
                      type: string
                    description: Annotations are key-value pairs for additional metadata
                    type: object
                  autoApprove:
                    default: true
                    description: AutoApprove indicates whether endpoints should be
                      auto-approved for hosting this service
                    type: boolean
                  comment:
                    description: Comment for service documentation
                    type: string
                  name:
                    description: |-
                      Name of the VIP service (e.g., "svc:web-service")
                      If not specified, defaults to "svc:<TailscaleServices-name>"
                    pattern: ^svc:[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                    type: string
                  ports:
                    description: |-
                      Ports the service should expose
                      Format: ["tcp:80", "udp:53", "tcp:443"]
                    items:
                      type: string
                    type: array
                  tags:
                    description: Tags for the VIP service (used in ACL policies)
                    items:
                      type: string
                    type: array
                type: object
            required:
            - selector
            type: object
          status:
            description: TailscaleServicesStatus defines the observed state of TailscaleServices
            properties:
              conditions:
                description: Conditions represent the current state of the TailscaleServices
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              discoveredServices:
                description: DiscoveredServices are services discovered through service
                  discovery
                items:
                  description: DiscoveredService represents a service discovered through
                    service discovery
                  properties:
                    address:
                      description: Address of the discovered service
                      type: string
                    discoverySource:
                      description: DiscoverySource indicates how this service was
                        discovered
                      type: string
                    lastDiscovered:
                      description: LastDiscovered when this service was last discovered
                      format: date-time
                      type: string
                    name:
                      description: Name of the discovered service
                      type: string
                    port:
                      description: Port of the discovered service
                      format: int32
                      type: integer
                    protocol:
                      description: Protocol of the discovered service
                      type: string
                    tags:
                      description: Tags associated with the discovered service
                      items:
                        type: string
                      type: array
                    type:
                      description: Type of service (vip-service, external-service)
                      enum:
                      - vip-service
                      - external-service
                      type: string
                  required:
                  - address
                  - discoverySource
                  - name
                  - port
                  - protocol
                  - type
                  type: object
                type: array
              healthyBackends:
                description: HealthyBackends is the number of healthy backends
                type: integer
              lastUpdate:
                description: LastUpdate indicates when the service status was last
                  updated
                format: date-time
                type: string
              loadBalancingStatus:
                description: LoadBalancingStatus provides load balancing statistics
                properties:
                  endpointWeights:
                    additionalProperties:
                      format: int32
                      type: integer
                    description: EndpointWeights shows current weights for weighted
                      load balancing
                    type: object
                  failoverStatus:
                    description: FailoverStatus tracks failover state
                    properties:
                      activeTier:
                        description: ActiveTier indicates which tier is currently
                          active (primary/secondary)
                        type: string
                      failoverReason:
                        description: FailoverReason explains why failover occurred
                        type: string
                      lastFailback:
                        description: LastFailback when the last failback occurred
                        format: date-time
                        type: string
                      lastFailover:
                        description: LastFailover when the last failover occurred
                        format: date-time
                        type: string
                    required:
                    - activeTier
                    type: object
                  requestCounts:
                    additionalProperties:
                      format: int64
                      type: integer
                    description: RequestCounts tracks request distribution (if available)
                    type: object
                  strategy:
                    description: Strategy is the active load balancing strategy
                    type: string
                required:
                - strategy
                type: object
              selectedEndpoints:
                description: SelectedEndpoints are the TailscaleEndpoints selected
                  by the selector
                items:
                  description: SelectedEndpoint represents a selected TailscaleEndpoints
                    resource
                  properties:
                    healthStatus:
                      description: HealthStatus indicates the health of backends from
                        this endpoint
                      properties:
                        healthyMachines:
                          description: HealthyMachines number of healthy machines
                            from this endpoint
                          type: integer
                        lastHealthCheck:
                          description: LastHealthCheck when health was last checked
                          format: date-time
                          type: string
                        unhealthyMachines:
                          description: UnhealthyMachines number of unhealthy machines
                            from this endpoint
                          type: integer
                      required:
                      - healthyMachines
                      - unhealthyMachines
                      type: object
                    labels:
                      additionalProperties:
                        type: string
                      description: Labels are the labels that matched the selector
                      type: object
                    lastSelected:
                      description: LastSelected when this endpoint was last selected
                      format: date-time
                      type: string
                    machines:
                      description: Machines are the individual machines from this
                        endpoint
                      items:
                        type: string
                      type: array
                    name:
                      description: Name of the TailscaleEndpoints resource
                      type: string
                    namespace:
                      description: Namespace of the TailscaleEndpoints resource
                      type: string
                    status:
                      description: Status indicates the status of this endpoint selection
                      enum:
                      - Ready
                      - Pending
                      - Failed
                      - NotFound
                      type: string
                  required:
                  - name
                  - namespace
                  - status
                  type: object
                type: array
              serviceInfo:
                description: ServiceInfo tracks information about the managed service
                properties:
                  consumerOperators:
                    description: ConsumerOperators are other operators using this
                      service
                    items:
                      type: string
                    type: array
                  lastCoordination:
                    description: LastCoordination when multi-operator coordination
                      last occurred
                    format: date-time
                    type: string
                  multiOperatorService:
                    description: MultiOperatorService indicates if this service is
                      shared across operators
                    type: boolean
                  ownerOperator:
                    description: OwnerOperator is the operator that created the VIP
                      service
                    type: string
                  serviceRegistryKey:
                    description: ServiceRegistryKey is the key used in service coordination
                    type: string
                required:
                - multiOperatorService
                type: object
              totalBackends:
                description: TotalBackends is the total number of backends in this
                  service
                type: integer
              unhealthyBackends:
                description: UnhealthyBackends is the number of unhealthy backends
                type: integer
              vipServiceStatus:
                description: VIPServiceStatus provides status of the created VIP service
                properties:
                  addresses:
                    description: Addresses are the allocated VIP addresses (IPv4 and
                      IPv6)
                    items:
                      type: string
                    type: array
                  backendCount:
                    description: BackendCount is the number of registered backends
                    type: integer
                  created:
                    description: Created indicates whether the VIP service was successfully
                      created
                    type: boolean
                  dnsName:
                    description: DNSName is the DNS name for the service
                    type: string
                  healthyBackendCount:
                    description: HealthyBackendCount is the number of healthy backends
                    type: integer
                  lastRegistration:
                    description: LastRegistration when backends were last registered
                    format: date-time
                    type: string
                  registrationErrors:
                    description: RegistrationErrors tracks errors in backend registration
                    items:
                      type: string
                    type: array
                  serviceName:
                    description: ServiceName is the actual name of the created VIP
                      service
                    type: string
                  serviceTags:
                    description: ServiceTags are the actual tags applied to the VIP
                      service
                    items:
                      type: string
                    type: array
                required:
                - backendCount
                - created
                - healthyBackendCount
                - serviceName
                type: object
            required:
            - healthyBackends
            - totalBackends
            - unhealthyBackends
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
