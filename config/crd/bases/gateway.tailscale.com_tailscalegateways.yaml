---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  name: tailscalegateways.gateway.tailscale.com
spec:
  group: gateway.tailscale.com
  names:
    categories:
    - tailscale-gateway
    kind: TailscaleGateway
    listKind: TailscaleGatewayList
    plural: tailscalegateways
    singular: tailscalegateway
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Referenced Envoy Gateway
      jsonPath: .spec.gatewayRef.name
      name: Gateway
      type: string
    - description: Number of configured tailnets
      jsonPath: .status.tailnetStatus.length
      name: Tailnets
      type: integer
    - description: Total discovered services
      jsonPath: .status.tailnetStatus[*].discoveredServices
      name: Services
      type: integer
    - description: Extension Server status
      jsonPath: .status.conditions[?(@.type=="ExtensionServerReady")].status
      name: Extension
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          TailscaleGateway integrates Envoy Gateway with Tailscale networking,
          enabling dynamic route injection based on tailnet topology.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: TailscaleGatewaySpec defines the desired state of TailscaleGateway
            properties:
              extensionServer:
                description: |-
                  ExtensionServer configures the gRPC extension server that implements
                  Envoy Gateway xDS hooks for dynamic route injection.
                properties:
                  image:
                    default: ghcr.io/rajsinghtech/tailscale-gateway-extension-server:latest
                    description: Image defines the container image for the Extension
                      Server
                    type: string
                  port:
                    description: |-
                      Port is the port number for the gRPC extension server.
                      Defaults to 8443.
                    format: int32
                    type: integer
                  replicas:
                    default: 2
                    description: Replicas defines the number of Extension Server replicas
                    format: int32
                    minimum: 1
                    type: integer
                  resources:
                    description: Resources defines resource requirements for Extension
                      Server pods
                    properties:
                      claims:
                        description: |-
                          Claims lists the names of resources, defined in spec.resourceClaims,
                          that are used by this container.

                          This is an alpha field and requires enabling the
                          DynamicResourceAllocation feature gate.

                          This field is immutable. It can only be set for containers.
                        items:
                          description: ResourceClaim references one entry in PodSpec.ResourceClaims.
                          properties:
                            name:
                              description: |-
                                Name must match the name of one entry in pod.spec.resourceClaims of
                                the Pod where this field is used. It makes that resource available
                                inside a container.
                              type: string
                            request:
                              description: |-
                                Request is the name chosen for a request in the referenced claim.
                                If empty, everything from the claim is made available, otherwise
                                only the result of this request.
                              type: string
                          required:
                          - name
                          type: object
                        type: array
                        x-kubernetes-list-map-keys:
                        - name
                        x-kubernetes-list-type: map
                      limits:
                        additionalProperties:
                          anyOf:
                          - type: integer
                          - type: string
                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                          x-kubernetes-int-or-string: true
                        description: |-
                          Limits describes the maximum amount of compute resources allowed.
                          More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                        type: object
                      requests:
                        additionalProperties:
                          anyOf:
                          - type: integer
                          - type: string
                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                          x-kubernetes-int-or-string: true
                        description: |-
                          Requests describes the minimum amount of compute resources required.
                          If Requests is omitted for a container, it defaults to Limits if that is explicitly specified,
                          otherwise to an implementation-defined value. Requests cannot exceed Limits.
                          More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                        type: object
                    type: object
                  serviceAccountName:
                    description: ServiceAccountName defines the ServiceAccount for
                      Extension Server pods
                    type: string
                  tls:
                    description: TLS configures TLS settings for the extension server.
                    properties:
                      certificateRef:
                        description: CertificateRef is a reference to a Secret containing
                          TLS certificates.
                        properties:
                          group:
                            default: ""
                            description: |-
                              Group is the group of the referent. For example, "gateway.networking.k8s.io".
                              When unspecified or empty string, core API group is inferred.
                            maxLength: 253
                            pattern: ^$|^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$
                            type: string
                          kind:
                            default: Secret
                            description: Kind is kind of the referent. For example
                              "Secret".
                            maxLength: 63
                            minLength: 1
                            pattern: ^[a-zA-Z]([-a-zA-Z0-9]*[a-zA-Z0-9])?$
                            type: string
                          name:
                            description: Name is the name of the referent.
                            maxLength: 253
                            minLength: 1
                            type: string
                          namespace:
                            description: |-
                              Namespace is the namespace of the referenced object. When unspecified, the local
                              namespace is inferred.

                              Note that when a namespace different than the local namespace is specified,
                              a ReferenceGrant object is required in the referent namespace to allow that
                              namespace's owner to accept the reference. See the ReferenceGrant
                              documentation for details.

                              Support: Core
                            maxLength: 63
                            minLength: 1
                            pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                            type: string
                        required:
                        - name
                        type: object
                      insecureSkipVerify:
                        description: |-
                          InsecureSkipVerify disables TLS certificate verification.
                          Should only be used for development/testing.
                        type: boolean
                    type: object
                required:
                - image
                - replicas
                type: object
              gatewayRef:
                description: |-
                  GatewayRef is a reference to the Envoy Gateway that this
                  TailscaleGateway should integrate with.
                properties:
                  group:
                    description: Group is the group of the target resource.
                    maxLength: 253
                    pattern: ^$|^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$
                    type: string
                  kind:
                    description: Kind is the kind of the target resource.
                    maxLength: 63
                    minLength: 1
                    pattern: ^[a-zA-Z]([-a-zA-Z0-9]*[a-zA-Z0-9])?$
                    type: string
                  name:
                    description: Name is the name of the target resource.
                    maxLength: 253
                    minLength: 1
                    type: string
                  namespace:
                    description: Namespace is the namespace of the target resource.
                    maxLength: 63
                    minLength: 1
                    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                    type: string
                  sectionName:
                    description: SectionName is the name of a section within the target
                      resource.
                    maxLength: 253
                    minLength: 1
                    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$
                    type: string
                required:
                - group
                - kind
                - name
                type: object
              tailnets:
                description: Tailnets defines the Tailscale networks and their service
                  discovery configuration
                items:
                  description: TailnetConfig defines configuration for a specific
                    Tailscale network
                  properties:
                    name:
                      description: Name is a unique identifier for this tailnet within
                        the gateway
                      pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                      type: string
                    routeGeneration:
                      description: RouteGeneration configures how routes are generated
                        for this tailnet
                      properties:
                        egress:
                          description: Egress configures routes for traffic from cluster
                            to tailnet
                          properties:
                            hostPattern:
                              default: '{service}.tailscale.local'
                              description: |-
                                HostPattern defines the hostname pattern for generated routes
                                Variables: {service}, {tailnet}, {domain}
                              type: string
                            pathPrefix:
                              default: /tailscale/{service}/
                              description: |-
                                PathPrefix defines the path prefix for generated routes
                                Variables: {service}, {tailnet}
                              type: string
                            protocol:
                              default: HTTP
                              description: Protocol defines the protocol for generated
                                routes
                              enum:
                              - HTTP
                              - HTTPS
                              type: string
                          required:
                          - hostPattern
                          - pathPrefix
                          - protocol
                          type: object
                        ingress:
                          description: Ingress configures routes for traffic from
                            tailnet to cluster
                          properties:
                            hostPattern:
                              default: '{service}.{tailnet}.gateway.local'
                              description: |-
                                HostPattern defines the hostname pattern for generated routes
                                Variables: {service}, {tailnet}, {domain}
                              type: string
                            pathPrefix:
                              default: /
                              description: PathPrefix defines the path prefix for
                                generated routes
                              type: string
                            protocol:
                              default: HTTPS
                              description: Protocol defines the protocol for generated
                                routes
                              enum:
                              - HTTP
                              - HTTPS
                              type: string
                          required:
                          - hostPattern
                          - pathPrefix
                          - protocol
                          type: object
                      type: object
                    serviceDiscovery:
                      description: ServiceDiscovery configures automatic service discovery
                        for this tailnet
                      properties:
                        enabled:
                          default: true
                          description: Enabled controls whether service discovery
                            is active for this tailnet
                          type: boolean
                        excludePatterns:
                          description: ExcludePatterns defines glob patterns for services
                            to exclude from discovery
                          items:
                            type: string
                          type: array
                        patterns:
                          description: Patterns defines glob patterns for services
                            to include in discovery
                          items:
                            type: string
                          type: array
                        syncInterval:
                          default: 30s
                          description: SyncInterval defines how often to sync with
                            Tailscale API
                          type: string
                      required:
                      - enabled
                      type: object
                    tailscaleTailnetRef:
                      description: TailscaleTailnetRef references the TailscaleTailnet
                        resource for this tailnet
                      properties:
                        group:
                          description: Group is the group of the target resource.
                          maxLength: 253
                          pattern: ^$|^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$
                          type: string
                        kind:
                          description: Kind is the kind of the target resource.
                          maxLength: 63
                          minLength: 1
                          pattern: ^[a-zA-Z]([-a-zA-Z0-9]*[a-zA-Z0-9])?$
                          type: string
                        name:
                          description: Name is the name of the target resource.
                          maxLength: 253
                          minLength: 1
                          type: string
                        namespace:
                          description: Namespace is the namespace of the target resource.
                          maxLength: 63
                          minLength: 1
                          pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                          type: string
                        sectionName:
                          description: SectionName is the name of a section within
                            the target resource.
                          maxLength: 253
                          minLength: 1
                          pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$
                          type: string
                      required:
                      - group
                      - kind
                      - name
                      type: object
                  required:
                  - name
                  - tailscaleTailnetRef
                  type: object
                minItems: 1
                type: array
            required:
            - gatewayRef
            - tailnets
            type: object
          status:
            description: TailscaleGatewayStatus defines the observed state of TailscaleGateway
            properties:
              conditions:
                description: Conditions represent the current state of the TailscaleGateway
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              extensionServerStatus:
                description: ExtensionServerStatus provides status for the Extension
                  Server
                properties:
                  desiredReplicas:
                    description: DesiredReplicas indicates the desired number of Extension
                      Server replicas
                    format: int32
                    type: integer
                  lastHookCall:
                    description: LastHookCall is the timestamp of the last successful
                      hook call.
                    format: date-time
                    type: string
                  ready:
                    description: Ready indicates if the extension server is ready
                      to accept connections.
                    type: boolean
                  readyReplicas:
                    description: ReadyReplicas indicates how many Extension Server
                      replicas are ready
                    format: int32
                    type: integer
                  serviceEndpoint:
                    description: ServiceEndpoint provides the gRPC endpoint for the
                      Extension Server
                    type: string
                required:
                - desiredReplicas
                - ready
                - readyReplicas
                type: object
              generatedRoutes:
                description: GeneratedRoutes tracks the number of routes generated
                  by this gateway
                properties:
                  egressRoutes:
                    description: EgressRoutes is the count of egress routes generated
                    type: integer
                  ingressRoutes:
                    description: IngressRoutes is the count of ingress routes generated
                    type: integer
                  lastGeneration:
                    description: LastGeneration indicates when routes were last generated
                    format: date-time
                    type: string
                required:
                - egressRoutes
                - ingressRoutes
                type: object
              services:
                description: Services tracks VIP services managed by this gateway
                items:
                  description: ServiceInfo provides information about a VIP service
                    managed by this gateway
                  properties:
                    consumerCount:
                      description: ConsumerCount is the number of clusters consuming
                        this service
                      type: integer
                    name:
                      description: Name is the service name
                      type: string
                    ownerCluster:
                      description: OwnerCluster indicates which cluster/operator owns
                        this service
                      type: string
                    vipAddresses:
                      description: VIPAddresses are the VIP addresses allocated to
                        this service
                      items:
                        type: string
                      type: array
                  required:
                  - consumerCount
                  - name
                  - ownerCluster
                  type: object
                type: array
              tailnetStatus:
                description: TailnetStatus provides status for each configured tailnet
                items:
                  description: TailnetStatus provides status information for a specific
                    tailnet
                  properties:
                    conditions:
                      description: Conditions represent the current state of this
                        tailnet
                      items:
                        description: Condition contains details for one aspect of
                          the current state of this API Resource.
                        properties:
                          lastTransitionTime:
                            description: |-
                              lastTransitionTime is the last time the condition transitioned from one status to another.
                              This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                            format: date-time
                            type: string
                          message:
                            description: |-
                              message is a human readable message indicating details about the transition.
                              This may be an empty string.
                            maxLength: 32768
                            type: string
                          observedGeneration:
                            description: |-
                              observedGeneration represents the .metadata.generation that the condition was set based upon.
                              For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                              with respect to the current state of the instance.
                            format: int64
                            minimum: 0
                            type: integer
                          reason:
                            description: |-
                              reason contains a programmatic identifier indicating the reason for the condition's last transition.
                              Producers of specific condition types may define expected values and meanings for this field,
                              and whether the values are considered a guaranteed API.
                              The value should be a CamelCase string.
                              This field may not be empty.
                            maxLength: 1024
                            minLength: 1
                            pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                            type: string
                          status:
                            description: status of the condition, one of True, False,
                              Unknown.
                            enum:
                            - "True"
                            - "False"
                            - Unknown
                            type: string
                          type:
                            description: type of condition in CamelCase or in foo.example.com/CamelCase.
                            maxLength: 316
                            pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                            type: string
                        required:
                        - lastTransitionTime
                        - message
                        - reason
                        - status
                        - type
                        type: object
                      type: array
                      x-kubernetes-list-map-keys:
                      - type
                      x-kubernetes-list-type: map
                    discoveredServices:
                      description: DiscoveredServices is the count of services discovered
                        in this tailnet
                      type: integer
                    lastSync:
                      description: LastSync indicates when service discovery last
                        succeeded
                      format: date-time
                      type: string
                    name:
                      description: Name identifies the tailnet
                      type: string
                  required:
                  - discoveredServices
                  - name
                  type: object
                type: array
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
